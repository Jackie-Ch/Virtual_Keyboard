const keysEng = [
  {
    Backquote: {
      value: "`",
      altValue: "~",
      isCapitals: false,
    },
  },
  {
    Digit1: {
      value: "1",
      altValue: "!",
      isCapitals: false,
    },
  },
  {
    Digit2: {
      value: "2",
      altValue: "@",
      isCapitals: false,
    },
  },
  {
    Digit3: {
      value: "3",
      altValue: "#",
      isCapitals: false,
    },
  },
  {
    Digit4: {
      value: "4",
      altValue: "$",
      isCapitals: false,
    },
  },
  {
    Digit5: {
      value: "5",
      altValue: "%",
      isCapitals: false,
    },
  },
  {
    Digit6: {
      value: "6",
      altValue: "^",
      isCapitals: false,
    },
  },
  {
    Digit7: {
      value: "7",
      altValue: "&",
      isCapitals: false,
    },
  },
  {
    Digit8: {
      value: "8",
      altValue: "*",
      isCapitals: false,
    },
  },
  {
    Digit9: {
      value: "9",
      altValue: "(",
      isCapitals: false,
    },
  },
  {
    Digit0: {
      value: "0",
      altValue: ")",
      isCapitals: false,
    },
  },
  {
    Minus: {
      value: "-",
      altValue: "_",
      isCapitals: false,
    },
  },
  {
    Equal: {
      value: "=",
      altValue: "+",
      isCapitals: false,
    },
  },
  {
    Backspace: {
      value: "&larr;",
      altValue: "&larr;",
      isCapitals: false,
    },
  },
  {
    Tab: {
      value: "Tab",
      altValue: "Tab",
      isCapitals: false,
    },
  },
  {
    KeyQ: {
      value: "q",
      altValue: "Q",
      isCapitals: false,
    },
  },
  {
    KeyW: {
      value: "w",
      altValue: "W",
      isCapitals: false,
    },
  },
  {
    KeyE: {
      value: "e",
      altValue: "E",
      isCapitals: false,
    },
  },
  {
    KeyR: {
      value: "r",
      altValue: "R",
      isCapitals: false,
    },
  },
  {
    KeyT: {
      value: "t",
      altValue: "T",
      isCapitals: false,
    },
  },
  {
    KeyY: {
      value: "y",
      altValue: "Y",
      isCapitals: false,
    },
  },
  {
    KeyU: {
      value: "u",
      altValue: "U",
      isCapitals: false,
    },
  },
  {
    KeyI: {
      value: "i",
      altValue: "I",
      isCapitals: false,
    },
  },
  {
    KeyO: {
      value: "o",
      altValue: "O",
      isCapitals: false,
    },
  },
  {
    KeyP: {
      value: "p",
      altValue: "P",
      isCapitals: false,
    },
  },
  {
    BracketLeft: {
      value: "[",
      altValue: "{",
      isCapitals: false,
    },
  },
  {
    BracketRight: {
      value: "]",
      altValue: "}",
      isCapitals: false,
    },
  },
  {
    Backslash: {
      value: "&#92",
      altValue: "|",
      isCapitals: false,
    },
  },
  {
    Delete: {
      value: "Del",
      altValue: "Del",
      isCapitals: false,
    },
  },
  {
    CapsLock: {
      value: "Caps Lock",
      altValue: "Caps Lock",
      isCapitals: false,
    },
  },
  {
    KeyA: {
      value: "a",
      altValue: "A",
      isCapitals: false,
    },
  },
  {
    KeyS: {
      value: "s",
      altValue: "S",
      isCapitals: false,
    },
  },
  {
    KeyD: {
      value: "d",
      altValue: "D",
      isCapitals: false,
    },
  },
  {
    KeyF: {
      value: "f",
      altValue: "F",
      isCapitals: false,
    },
  },
  {
    KeyG: {
      value: "g",
      altValue: "G",
      isCapitals: false,
    },
  },
  {
    KeyH: {
      value: "h",
      altValue: "H",
      isCapitals: false,
    },
  },
  {
    KeyJ: {
      value: "j",
      altValue: "J",
      isCapitals: false,
    },
  },
  {
    KeyK: {
      value: "k",
      altValue: "K",
      isCapitals: false,
    },
  },
  {
    KeyL: {
      value: "l",
      altValue: "L",
      isCapitals: false,
    },
  },
  {
    Semicolon: {
      value: ";",
      altValue: ":",
      isCapitals: false,
    },
  },
  {
    Quote: {
      value: "'",
      altValue: '"',
      isCapitals: false,
    },
  },
  {
    Enter: {
      value: "Enter",
      altValue: "Enter",
      isCapitals: false,
    },
  },
  {
    ShiftLeft: {
      value: "Shift",
      altValue: "Shift",
      isCapitals: false,
    },
  },
  {
    KeyZ: {
      value: "z",
      altValue: "Z",
      isCapitals: false,
    },
  },
  {
    KeyX: {
      value: "x",
      altValue: "X",
      isCapitals: false,
    },
  },
  {
    KeyC: {
      value: "c",
      altValue: "C",
      isCapitals: false,
    },
  },
  {
    KeyV: {
      value: "v",
      altValue: "V",
      isCapitals: false,
    },
  },
  {
    KeyB: {
      value: "b",
      altValue: "B",
      isCapitals: false,
    },
  },
  {
    KeyN: {
      value: "n",
      altValue: "N",
      isCapitals: false,
    },
  },
  {
    KeyM: {
      value: "m",
      altValue: "M",
      isCapitals: false,
    },
  },
  {
    Comma: {
      value: ",",
      altValue: "<",
      isCapitals: false,
    },
  },
  {
    Period: {
      value: ".",
      altValue: ">",
      isCapitals: false,
    },
  },
  {
    Slash: {
      value: "/",
      altValue: "?",
      isCapitals: false,
    },
  },
  {
    ArrowUp: {
      value: "&uarr;",
      altValue: "&uarr;",
      isCapitals: false,
    },
  },
  {
    ShiftRight: {
      value: "Shift",
      altValue: "Shift",
      isCapitals: false,
    },
  },
  {
    ControlLeft: {
      value: "Ctrl",
      altValue: "Ctrl",
      isCapitals: false,
    },
  },
  {
    MetaLeft: {
      value: "Win",
      altValue: "Win",
      isCapitals: false,
    },
  },
  {
    AltLeft: {
      value: "Alt",
      altValue: "Alt",
      isCapitals: false,
    },
  },
  {
    Space: {
      value: "Space",
      altValue: "Space",
      isCapitals: false,
    },
  },
  {
    AltRight: {
      value: "Alt",
      altValue: "Alt",
      isCapitals: false,
    },
  },
  {
    ArrowLeft: {
      value: "&larr;",
      altValue: "&larr;",
      isCapitals: false,
    },
  },
  {
    ArrowDown: {
      value: "&darr;",
      altValue: "&darr;",
      isCapitals: false,
    },
  },
  {
    ArrowRight: {
      value: "&rarr;",
      altValue: "&rarr;",
      isCapitals: false,
    },
  },
  {
    ControlRight: {
      value: "Ctrl",
      altValue: "Ctrl",
      isCapitals: false,
    },
  },
];
const keysRu = [
  {
    Backquote: {
      value: "ё",
      altValue: "Ё",
      isCapitals: false,
    },
  },
  {
    Digit1: {
      value: "1",
      altValue: "!",
      isCapitals: false,
    },
  },
  {
    Digit2: {
      value: "2",
      altValue: '"',
      isCapitals: false,
    },
  },
  {
    Digit3: {
      value: "3",
      altValue: "№",
      isCapitals: false,
    },
  },
  {
    Digit4: {
      value: "4",
      altValue: ";",
      isCapitals: false,
    },
  },
  {
    Digit5: {
      value: "5",
      altValue: "%",
      isCapitals: false,
    },
  },
  {
    Digit6: {
      value: "6",
      altValue: ":",
      isCapitals: false,
    },
  },
  {
    Digit7: {
      value: "7",
      altValue: "?",
      isCapitals: false,
    },
  },
  {
    Digit8: {
      value: "8",
      altValue: "*",
      isCapitals: false,
    },
  },
  {
    Digit9: {
      value: "9",
      altValue: "(",
      isCapitals: false,
    },
  },
  {
    Digit0: {
      value: "0",
      altValue: ")",
      isCapitals: false,
    },
  },
  {
    Minus: {
      value: "-",
      altValue: "_",
      isCapitals: false,
    },
  },
  {
    Equal: {
      value: "=",
      altValue: "+",
      isCapitals: false,
    },
  },
  {
    Backspace: {
      value: "&larr;",
      altValue: "&larr;",
      isCapitals: false,
    },
  },
  {
    Tab: {
      value: "Tab",
      altValue: "Tab",
      isCapitals: false,
    },
  },
  {
    KeyQ: {
      value: "й",
      altValue: "Й",
      isCapitals: false,
    },
  },
  {
    KeyW: {
      value: "ц",
      altValue: "Ц",
      isCapitals: false,
    },
  },
  {
    KeyE: {
      value: "у",
      altValue: "У",
      isCapitals: false,
    },
  },
  {
    KeyR: {
      value: "к",
      altValue: "К",
      isCapitals: false,
    },
  },
  {
    KeyT: {
      value: "е",
      altValue: "Е",
      isCapitals: false,
    },
  },
  {
    KeyY: {
      value: "н",
      altValue: "Н",
      isCapitals: false,
    },
  },
  {
    KeyU: {
      value: "г",
      altValue: "Г",
      isCapitals: false,
    },
  },
  {
    KeyI: {
      value: "ш",
      altValue: "Ш",
      isCapitals: false,
    },
  },
  {
    KeyO: {
      value: "щ",
      altValue: "Щ",
      isCapitals: false,
    },
  },
  {
    KeyP: {
      value: "з",
      altValue: "З",
      isCapitals: false,
    },
  },
  {
    BracketLeft: {
      value: "х",
      altValue: "Х",
      isCapitals: false,
    },
  },
  {
    BracketRight: {
      value: "ъ",
      altValue: "Ъ",
      isCapitals: false,
    },
  },
  {
    Backslash: {
      value: "&#92",
      altValue: "|",
      isCapitals: false,
    },
  },
  {
    Delete: {
      value: "Del",
      altValue: "Del",
      isCapitals: false,
    },
  },
  {
    CapsLock: {
      value: "Caps Lock",
      altValue: "Caps Lock",
      isCapitals: false,
    },
  },
  {
    KeyA: {
      value: "ф",
      altValue: "Ф",
      isCapitals: false,
    },
  },
  {
    KeyS: {
      value: "ы",
      altValue: "Ы",
      isCapitals: false,
    },
  },
  {
    KeyD: {
      value: "в",
      altValue: "В",
      isCapitals: false,
    },
  },
  {
    KeyF: {
      value: "а",
      altValue: "А",
      isCapitals: false,
    },
  },
  {
    KeyG: {
      value: "п",
      altValue: "П",
      isCapitals: false,
    },
  },
  {
    KeyH: {
      value: "р",
      altValue: "Р",
      isCapitals: false,
    },
  },
  {
    KeyJ: {
      value: "о",
      altValue: "О",
      isCapitals: false,
    },
  },
  {
    KeyK: {
      value: "л",
      altValue: "Л",
      isCapitals: false,
    },
  },
  {
    KeyL: {
      value: "д",
      altValue: "Д",
      isCapitals: false,
    },
  },
  {
    Semicolon: {
      value: "ж",
      altValue: "Ж",
      isCapitals: false,
    },
  },
  {
    Quote: {
      value: "э",
      altValue: "Э",
      isCapitals: false,
    },
  },
  {
    Enter: {
      value: "Enter",
      altValue: "Enter",
      isCapitals: false,
    },
  },
  {
    ShiftLeft: {
      value: "Shift",
      altValue: "Shift",
      isCapitals: false,
    },
  },
  {
    KeyZ: {
      value: "я",
      altValue: "Я",
      isCapitals: false,
    },
  },
  {
    KeyX: {
      value: "ч",
      altValue: "Ч",
      isCapitals: false,
    },
  },
  {
    KeyC: {
      value: "с",
      altValue: "С",
      isCapitals: false,
    },
  },
  {
    KeyV: {
      value: "м",
      altValue: "М",
      isCapitals: false,
    },
  },
  {
    KeyB: {
      value: "и",
      altValue: "И",
      isCapitals: false,
    },
  },
  {
    KeyN: {
      value: "т",
      altValue: "Т",
      isCapitals: false,
    },
  },
  {
    KeyM: {
      value: "ь",
      altValue: "Ь",
      isCapitals: false,
    },
  },
  {
    Comma: {
      value: "б",
      altValue: "Б",
      isCapitals: false,
    },
  },
  {
    Period: {
      value: "ю",
      altValue: "Ю",
      isCapitals: false,
    },
  },
  {
    Slash: {
      value: ".",
      altValue: ",",
      isCapitals: false,
    },
  },
  {
    ArrowUp: {
      value: "&uarr;",
      altValue: "&uarr;",
      isCapitals: false,
    },
  },
  {
    ShiftRight: {
      value: "Shift",
      altValue: "Shift",
      isCapitals: false,
    },
  },
  {
    ControlLeft: {
      value: "Ctrl",
      altValue: "Ctrl",
      isCapitals: false,
    },
  },
  {
    MetaLeft: {
      value: "Win",
      altValue: "Win",
      isCapitals: false,
    },
  },
  {
    AltLeft: {
      value: "Alt",
      altValue: "Alt",
      isCapitals: false,
    },
  },
  {
    Space: {
      value: "Space",
      altValue: "Space",
      isCapitals: false,
    },
  },
  {
    AltRight: {
      value: "Alt",
      altValue: "Alt",
      isCapitals: false,
    },
  },
  {
    ArrowLeft: {
      value: "&larr;",
      altValue: "&larr;",
      isCapitals: false,
    },
  },
  {
    ArrowDown: {
      value: "&darr;",
      altValue: "&darr;",
      isCapitals: false,
    },
  },
  {
    ArrowRight: {
      value: "&rarr;",
      altValue: "&rarr;",
      isCapitals: false,
    },
  },
  {
    ControlRight: {
      value: "Ctrl",
      altValue: "Ctrl",
      isCapitals: false,
    },
  },
];

let language = false;
let initialLanguage = keysEng;
let capslock = false;

const root = document.createElement("div");
root.classList.add("root");

const capsLockIndicator = document.createElement("div");
capsLockIndicator.classList.add("capslock-indicator");

const textArea = document.createElement("textarea");
textArea.classList.add("text-area");
textArea.maxLength = 100;
textArea.rows = 10;

const keyBox = document.createElement("div");
keyBox.classList.add("key-box");

root.append(capsLockIndicator, textArea, keyBox);
document.body.append(root);

function render() {
  const lang = JSON.parse(localStorage.getItem("lang"));
  console.log(lang ? "ru" : "eng");
  (lang ? keysRu : initialLanguage).forEach((keys) => {
    for (const [button, buttonValue] of Object.entries(keys)) {
      const divKey = document.createElement("div");
      divKey.classList.add(button.toLowerCase(), "key");
      divKey.innerHTML = `${
        capslock ? buttonValue.altValue : buttonValue.value
      }`;
      keyBox.append(divKey);
    }
  });
}
render();

function addTextInTextarea() {
  document.body.addEventListener("keydown", (event) => {
    if (event.code === "Enter") {
      return;
    } else if (event.code === "Backquote") {
      textArea.value += "`";
    } else if (event.code === "Tab") {
      return;
    } else if (event.code === "Delete") {
      return;
    } else if (event.code === "Backspace") {
      return;
    } else if (event.code === "CapsLock") {
      return;
    } else if (event.code === "ShiftLeft") {
      return;
    } else if (
      event.code === "ArrowUp" ||
      event.code === "ArrowDown" ||
      event.code === "ArrowLeft" ||
      event.code === "ArrowRight"
    ) {
      const elem = document.querySelector(`.${event.code.toLocaleLowerCase()}`);
      textArea.value += elem.innerHTML;
    } else if (event.code === "Space") {
      textArea.value += " ";
    } else if (
      event.code === "ShiftLeft" &&
      event.altKey === true &&
      event.shiftKey === true
    ) {
      return;
    } else if (event.code === "AltLeft") {
      return;
    } else if (event.code === "ControlRight") {
      return;
    } else if (event.code === "ShiftRight") {
      return;
    } else if (event.code === "AltRight") {
      return;
    } else if (event.code === "ControlLeft") {
      return;
    } else {
      if (language) {
        if (capslock) {
          keysRu.map((obj) => {
            for (const [key, objValue] of Object.entries(obj)) {
              if (key === event.code) {
                textArea.value += objValue.altValue;
              }
            }
          });
        } else {
          keysRu.map((obj) => {
            for (const [key, objValue] of Object.entries(obj)) {
              if (key === event.code) {
                textArea.value += objValue.value;
              }
            }
          });
        }
      } else {
        textArea.value += event.key;
      }
    }
  });

  keyBox.addEventListener("click", (event) => {
    if (event.target.classList[0] === "enter") {
      return;
    } else if (event.target.classList[0] === "tab") {
      return;
    } else if (event.target.classList[0] === "delete") {
      return;
    } else if (event.target.classList[0] === "backspace") {
      return;
    } else if (event.target.classList[0] === "metaleft") {
      return;
    } else if (event.target.classList[0] === "controlleft") {
      return;
    } else if (event.target.classList[0] === "altleft") {
      return;
    } else if (event.target.classList[0] === "shiftright") {
      return;
    } else if (event.target.classList[0] === "altright") {
      return;
    } else if (event.target.classList[0] === "controlright") {
      return;
    } else if (event.target.classList[0] === "space") {
      textArea.value += " ";
    } else if (event.target.classList[1] === "key") {
      textArea.value += event.target.innerText;
    }
  });
}
addTextInTextarea();

function highlightingKeys() {
  document.body.addEventListener("keydown", (event) => {
    event.preventDefault();
    const elem = document.querySelector(`.${event.code.toLocaleLowerCase()}`);
    if (elem?.classList[0] === event.code.toLocaleLowerCase()) {
      elem.classList.add("active");
    }
  });

  document.body.addEventListener("keyup", (event) => {
    event.preventDefault();
    const elem = document.querySelector(`.${event.code.toLocaleLowerCase()}`);
    if (elem?.classList[0] === event.code.toLocaleLowerCase()) {
      elem.classList.remove("active");
    }
  });

  keyBox.addEventListener("mousedown", (event) => {
    if (event.target.classList[1] === "key") {
      event.target.classList.add("active");
      setTimeout(() => {
        event.target.classList.remove("active");
      }, 100);
    }
  });
}
highlightingKeys();

function switchLanguage() {
  document.body.addEventListener("keydown", (event) => {
    if (
      (event.code === "ControlLeft" && event.altKey === true) ||
      (event.code === "AltLeft" && event.ctrlKey === true)
    ) {
      language = !language;
      initialLanguage = language ? keysRu : keysEng;
      keyBox.innerHTML = "";
      localStorage.setItem("lang", language);
      render();
    }
  });
}
switchLanguage();

function handleEnterKey() {
  document.body.addEventListener("keydown", (event) => {
    event.preventDefault();
    if (event.code === "Enter") {
      textArea.value += "\n";
    }
  });

  keyBox.addEventListener("click", (event) => {
    if (event.target.classList[0] === "enter") {
      textArea.value += "\n";
    }
  });
}
handleEnterKey();

function handleCapsLockKey() {
  document.body.addEventListener("keydown", (event) => {
    if (event.repeat) return;
    if (event.code === "CapsLock") {
      capslock = !capslock;

      capslock
        ? capsLockIndicator.classList.add("active-caps")
        : capsLockIndicator.classList.remove("active-caps");

      initialLanguage.forEach((keys) => {
        for (const [button, buttonValue] of Object.entries(keys)) {
          if (
            button === "Backquote" ||
            button === "Digit1" ||
            button === "Digit2" ||
            button === "Digit3" ||
            button === "Digit4" ||
            button === "Digit5" ||
            button === "Digit6" ||
            button === "Digit7" ||
            button === "Digit8" ||
            button === "Digit9" ||
            button === "Digit0" ||
            button === "Minus" ||
            button === "Equal"
          ) {
          } else {
            buttonValue.isCapitals = true;
          }
          keyBox.innerHTML = "";
          render();
        }
      });

      keyBox.innerHTML = "";
      render();
    }
  });

  keyBox.addEventListener("mousedown", (event) => {
    if (event.target.classList[0] === "capslock") {
      capslock = !capslock;

      capslock
        ? capsLockIndicator.classList.add("active-caps")
        : capsLockIndicator.classList.remove("active-caps");

      keyBox.innerHTML = "";
      render();
    }
  });
}
handleCapsLockKey();

function handleShiftKey() {
  document.body.addEventListener("keydown", (event) => {
    if (event.repeat) return;
    if (event.code === "ShiftLeft") {
      capslock = !capslock;
      keyBox.innerHTML = "";
      highlightingKeys();
      render();
    }
  });

  document.body.addEventListener("keyup", (event) => {
    event.preventDefault();
    if (event.code === "ShiftLeft") {
      capslock = !capslock;
      keyBox.innerHTML = "";
      highlightingKeys();
      render();
    }
  });

  keyBox.addEventListener("mousedown", (event) => {
    if (event.target.classList[0] === "shiftleft") {
      capslock = !capslock;
      keyBox.innerHTML = "";
      highlightingKeys();
      render();
    }
  });
  keyBox.addEventListener("mouseup", (event) => {
    if (event.target.classList[0] === "shiftleft") {
      capslock = !capslock;
      keyBox.innerHTML = "";
      render();
    }
  });
}
handleShiftKey();

function handleBackspaceKey() {
  keyBox.addEventListener("click", (event) => {
    if (event.target.classList[0] === "backspace") {
      textArea.value = textArea.value.slice(0, -1);
    }
  });

  document.body.addEventListener("keydown", (event) => {
    if (event.code === "Backspace") {
      textArea.value = textArea.value.slice(0, -1);
    }
  });
}
handleBackspaceKey();

function handleTabKey() {
  keyBox.addEventListener("click", (event) => {
    if (event.target.classList[0] === "tab") {
      textArea.value += "    ";
    }
  });

  document.body.addEventListener("keydown", (event) => {
    if (event.code === "Tab") {
      textArea.value += "    ";
    }
  });
}
handleTabKey();
